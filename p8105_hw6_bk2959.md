p8105_hw6_bk2959
================
Stella Koo
2024-11-16

## Problem 2

### Data Cleaning

``` r
library(tidyverse)

homicide_df = read_csv("homicide.csv") |>
  janitor::clean_names() |>
  mutate(city_state = str_c(city, state, sep = ", "),
         solved = ifelse(disposition %in% c("Closed without arrest", "Closed by arrest"), 1, 0), 
         victim_age = as.numeric(victim_age)) |>
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"),
         victim_race %in% c("White", "Black"))
```

### Baltimore, MD

The following presents the results of a logistic regression analysis
conducted in Baltimore, MD, with resolved vs unresolved as the outcome
variable. The predictors in the model include victim age, sex, and race.
The table summarizes the estimated effects of each predictor on the
outcome.

``` r
baltimore_fit = homicide_df |>
  filter(city_state == "Baltimore, MD") |>
  glm(solved ~ victim_age + victim_sex + victim_race, family = "binomial", data = _)

broom::tidy(baltimore_fit)
```

    ## # A tibble: 4 × 5
    ##   term             estimate std.error statistic  p.value
    ##   <chr>               <dbl>     <dbl>     <dbl>    <dbl>
    ## 1 (Intercept)       0.664     0.174        3.80 1.42e- 4
    ## 2 victim_age       -0.00520   0.00325     -1.60 1.10e- 1
    ## 3 victim_sexMale   -1.04      0.143       -7.26 3.74e-13
    ## 4 victim_raceWhite  0.900     0.180        4.99 6.04e- 7

The estimate and confidence interval for the adjusted odds ratio (OR)
comparing male victims to female victims for solving homicides, while
holding all other variables constant, were obtained using the following
approach:

``` r
odds_ratio_est = exp(coef(baltimore_fit)["victim_sexMale"])
odds_ratio_est
```

    ## victim_sexMale 
    ##      0.3546711

``` r
odds_ratio_ci = exp(confint(baltimore_fit, "victim_sexMale"))
```

    ## Waiting for profiling to be done...

``` r
odds_ratio_ci
```

    ##     2.5 %    97.5 % 
    ## 0.2672667 0.4679109

### All cities

The adjusted odds ratio and confidence interval for solving homicides,
comparing male victims to female victims, were calculated for each city
in the dataset.

``` r
model_or_ci = function(city_data){
  
  fit = glm(solved ~ victim_age + victim_sex + victim_race, family = "binomial", data = city_data) |>
    broom::tidy(conf.int = TRUE, exponentiate = TRUE) |>
    filter(term == "victim_sexMale") |>
    select(odds_ratio = estimate, conf.low, conf.high)
  
}

cities_fit = homicide_df |>
  group_by(city_state) |>
  nest() |>
  mutate(results = map(data, model_or_ci)) |>
  unnest(results) |>
  select(-data)
```

    ## Warning: There were 43 warnings in `mutate()`.
    ## The first warning was:
    ## ℹ In argument: `results = map(data, model_or_ci)`.
    ## ℹ In group 1: `city_state = "Albuquerque, NM"`.
    ## Caused by warning:
    ## ! glm.fit: fitted probabilities numerically 0 or 1 occurred
    ## ℹ Run `dplyr::last_dplyr_warnings()` to see the 42 remaining warnings.

``` r
cities_fit 
```

    ## # A tibble: 47 × 4
    ## # Groups:   city_state [47]
    ##    city_state      odds_ratio conf.low conf.high
    ##    <chr>                <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM      0.430   0.132      1.16 
    ##  2 Atlanta, GA          0.512   0.323      0.789
    ##  3 Baltimore, MD        0.355   0.267      0.468
    ##  4 Baton Rouge, LA      0.319   0.160      0.596
    ##  5 Birmingham, AL       0.704   0.444      1.09 
    ##  6 Boston, MA           0.674   0.353      1.28 
    ##  7 Buffalo, NY          0.438   0.239      0.793
    ##  8 Charlotte, NC        0.301   0.143      0.572
    ##  9 Chicago, IL          0.391   0.321      0.476
    ## 10 Cincinnati, OH       0.206   0.0977     0.390
    ## # ℹ 37 more rows

``` r
ggplot(cities_fit, aes(x = reorder(city_state, odds_ratio), 
                       y = odds_ratio, 
                       ymin = conf.low, 
                       ymax = conf.high)) +
  geom_pointrange() +
  coord_flip() +
  labs(x = "City, State",
    y = "Estimated Odds Ratio (OR)",
    title = "Estimated Odds Ratios for Solving Homicides by Sex") +  
  theme(axis.text.y = element_text(size = 8))
```

![](p8105_hw6_bk2959_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->
